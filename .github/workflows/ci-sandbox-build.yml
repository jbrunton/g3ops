# File generated by g3ops, do not modify
# Source: .g3ops/workflows/ci-sandbox-build/template.jsonnet
"env":
  "G3OPS_CONTEXT": "test/sandbox/.g3ops/config.yml"
"jobs":
  "build":
    "env":
      "G3OPS_DOCKER_ACCESS_TOKEN": "${{ secrets.G3OPS_DOCKER_ACCESS_TOKEN }}"
      "G3OPS_DOCKER_USERNAME": "${{ secrets.G3OPS_DOCKER_USERNAME }}"
    "if": "${{ needs.manifest_check.outputs.buildRequired == true }}"
    "name": "sandbox_build"
    "needs": "manifest_check"
    "runs-on": "ubuntu-latest"
    "steps":
    - "uses": "actions/checkout@v2"
      "with":
        "token": "${{ secrets.G3OPS_ADMIN_ACCESS_TOKEN }}"
    - "uses": "actions/setup-go@v2"
      "with":
        "go-version": "^1.14.4"
    - "name": "install g3ops"
      "run": "go get github.com/jbrunton/g3ops"
    - "name": "build"
      "run": "g3ops service build ${{ matrix.service }}"
    - "name": "commit"
      "run": |
        git config --global user.name 'jbrunton-ci-minion'
        git config --global user.email 'jbrunton-ci-minion@outlook.com'
        g3ops commit build ${{ matrix.service }}
        git push origin:master
    "strategy":
      "matrix": "${{ fromJson(needs.manifest_check.outputs.buildMatrix) }}"
  "manifest_check":
    "if": "github.event_name == 'push'"
    "name": "sandbox_manifest_check"
    "outputs":
      "buildMatrix": "${{ steps.check.outputs.buildMatrix }}"
      "buildRequired": "${{ steps.check.outputs.buildRequired }}"
    "runs-on": "ubuntu-latest"
    "steps":
    - "uses": "actions/checkout@v2"
    - "uses": "actions/setup-go@v2"
      "with":
        "go-version": "^1.14.4"
    - "name": "install g3ops"
      "run": "go get github.com/jbrunton/g3ops"
    - "id": "check"
      "name": "check manifest"
      "run": "g3ops set-outputs build-matrix"
"name": "ci-sandbox-build"
"on":
  "pull_request":
    "branches":
    - "master"
  "push":
    "branches":
    - "master"
