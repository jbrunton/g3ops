# File generated by g3ops, do not modify
# Source: .g3ops/workflows/g3ops/template.jsonnet
"jobs":
  "check_manifest":
    "needs":
    - "check_workflows"
    "outputs":
      "releaseName": "${{ steps.check_release.outputs.releaseName }}"
      "releaseRequired": "${{ steps.check_release.outputs.releaseRequired }}"
    "runs-on": "ubuntu-latest"
    "steps":
    - "uses": "actions/checkout@v2"
    - "uses": "actions/setup-go@v2"
      "with":
        "go-version": "^1.14.4"
    - "name": "install g3ops"
      "run": "go get github.com/jbrunton/g3ops"
    - "env":
        "GITHUB_TOKEN": "${{ secrets.GITHUB_TOKEN }}"
      "id": "check_release"
      "if": "github.event_name == 'push' && github.event.ref == format('refs/heads/{0}', 'master')"
      "name": "check release manifest"
      "run": "g3ops ci check release-manifest"
  "check_workflows":
    "name": "check-workflows"
    "runs-on": "ubuntu-latest"
    "steps":
    - "uses": "actions/checkout@v2"
    - "uses": "actions/setup-go@v2"
      "with":
        "go-version": "^1.14.4"
    - "name": "install g3ops"
      "run": "go get github.com/jbrunton/g3ops"
    - "env":
        "G3OPS_CONFIG": ".g3ops/config.yml"
      "name": "validate g3ops workflows"
      "run": "g3ops workflows check"
    - "env":
        "G3OPS_CONFIG": "test/sandbox/.g3ops/config.yml"
      "name": "validate sandbox workflows"
      "run": "g3ops workflows check"
  "release":
    "if": "${{ needs.check_manifest.outputs.releaseRequired == true }}"
    "needs": "check_manifest"
    "runs-on": "ubuntu-latest"
    "steps":
    - "uses": "actions/checkout@v2"
    - "run": "git config --global user.name 'jbrunton-ci-minion'"
    - "run": "git config --global user.email 'jbrunton-ci-minion@outlook.com'"
    - "run": "git fetch --unshallow"
    - "run": "go build"
    - "run": "npm install"
    - "env":
        "GITHUB_TOKEN": "${{ secrets.GITHUB_TOKEN }}"
        "RELEASE_NAME": "${{ steps.check_manifest.outputs.releaseName }}"
      "run": "npm run release -- $RELEASE_NAME"
"name": "g3ops"
"on":
  "pull_request":
    "branches":
    - "master"
  "push":
    "branches":
    - "master"
