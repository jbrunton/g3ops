# File generated by gflows, do not modify
# Source: test/sandbox/.gflows/workflows/sandbox-deploy
name: sandbox-build
"on":
  workflow_run:
    workflows:
    - sandbox-build
    branches:
    - develop
    types:
    - completed
env:
  CI: 1
  G3OPS_CONFIG: test/sandbox/.g3ops/config.yml
jobs:
  manifest_check:
    runs-on: ubuntu-latest
    outputs:
      deploymentsRequired: ${{ steps.check.outputs.deploymentsRequired }}
      deploymentMatrix: ${{ steps.check.outputs.deploymentMatrix }}
    steps:
    - uses: actions/checkout@v2
    - name: check
      id: check
      run: go run main.go manifest check
  deploy:
    needs: manifest_check
    if: needs.manifest_check.outputs.deploymentsRequired == true
    runs-on: ubuntu-latest
    strategy:
      matrix: ${{ fromJson(needs.manifest_check.outputs.deploymentMatrix) }}
    steps:
    - uses: actions/checkout@v2
      with:
        token: ${{ secrets.G3OPS_ADMIN_ACCESS_TOKEN }}
    - name: configure git
      run: |
        git config --global user.email "jbrunton-ci-minion@outlook.com"
        git config --global user.name "jbrunton-ci-minion"
    - uses: k14s/setup-k14s-action@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
    - env:
        ENVIRONMENT: ${{ matrix.environment }}
        VERSION: ${{ matrix.version }}
      run: go run main.go deploy $VERSION $ENVIRONMENT
