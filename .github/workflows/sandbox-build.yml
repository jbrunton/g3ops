# File generated by gflows, do not modify
# Source: test/sandbox/.gflows/workflows/sandbox-build
name: sandbox-build
"on":
  workflow_run:
    workflows:
    - sandbox-test
    branches:
    - develop
    types:
    - completed
env:
  CI: 1
  G3OPS_CONFIG: test/sandbox/.g3ops/config.yml
jobs:
  manifest_check:
    runs-on: ubuntu-latest
    outputs:
      buildRequired: ${{ steps.check.outputs.buildRequired }}
    steps:
    - uses: actions/checkout@v2
    - name: check
      id: check
      run: go run main.go manifest check
  build:
    needs: manifest_check
    if: needs.manifest_check.outputs.buildRequired == true
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
      with:
        token: ${{ secrets.G3OPS_ADMIN_ACCESS_TOKEN }}
    - name: configure git
      run: |
        git config --global user.email "jbrunton-ci-minion@outlook.com"
        git config --global user.name "jbrunton-ci-minion"
        git config pull.rebase false
    - uses: k14s/setup-k14s-action@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
    - env:
        G3OPS_DOCKER_ACCESS_TOKEN: ${{ secrets.G3OPS_DOCKER_ACCESS_TOKEN }}
        G3OPS_DOCKER_USERNAME: ${{ secrets.G3OPS_DOCKER_USERNAME }}
      run: go run main.go build
