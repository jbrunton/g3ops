# File generated by g3ops, do not modify
# Source: .g3ops/workflows/g3ops/g3ops-release/template.jsonnet
"jobs":
  "check_manifest":
    "outputs":
      "releaseName": "${{ steps.check.outputs.releaseName }}"
      "releaseRequired": "${{ steps.check.outputs.releaseRequired }}"
    "runs-on": "ubuntu-latest"
    "steps":
    - "uses": "actions/checkout@v2"
    - "uses": "actions/setup-go@v2"
      "with":
        "go-version": "^1.14.4"
    - "name": "install g3ops"
      "run": "go get github.com/jbrunton/g3ops"
    - "env":
        "GITHUB_TOKEN": "${{ secrets.GITHUB_TOKEN }}"
      "id": "check"
      "name": "check manifest"
      "run": "g3ops ci check release-manifest"
  "release":
    "if": "${{ needs.check_manifest.outputs.releaseRequired == true }}"
    "needs": "check_manifest"
    "runs-on": "ubuntu-latest"
    "steps":
    - "uses": "actions/checkout@v2"
    - "run": "git config --global user.name 'jbrunton-ci-minion'"
    - "run": "git config --global user.email 'jbrunton-ci-minion@outlook.com'"
    - "run": "git fetch --unshallow"
    - "run": "go build"
    - "run": "npm install"
    - "env":
        "GITHUB_TOKEN": "${{ secrets.GITHUB_TOKEN }}"
        "RELEASE_NAME": "${{ steps.check_manifest.outputs.releaseName }}"
      "run": "npm run release -- $RELEASE_NAME"
"name": "g3ops-release"
"on":
  "push":
    "branches":
    - "master"
